(function(t){let r={},h="canto.com",y="52ff8ed9d6874d48a3bef9621bc1af26",b,p;const m="CantoDamConnector",f={env:"canto.com"};function g(e,s){this.element=e,this.options=t.extend({},f,s),this._defaults=f,this._name=m,this.init()}g.prototype={init:function(){t(()=>{A(this.options);const e=n=>"#fields-"+Craft.namespaceId(n,this.options.id),s=e("damAssetPreview");d();function d(){const n=e("damAssetPreviewWrapper");if(t(n).remove(),t(s).attr("data-thumbnailurl")==null||t(s).attr("data-thumbnailurl")=="none")t(s).hide();else{const a=t(s).attr("data-thumbnailurl");let i=t(s).attr("data-thumbnailName");const c=t(s).attr("data-assetCount"),l=c==1?"":"canto-asset-preview-stack";i=c==1?i:`${c} images`,t(e("chooseAsset")).html("Choose a Different DAM Asset"),t(s).prepend(`
<div id="${n.slice(1)}">
<img class="${l}" style="max-height:200px; max-width:200px;" src=${a}>
<span>${i}</span><br />
</div>
`)}}function u(n){t.ajax({type:"POST",url:"https://oauth.canto.com/oauth/api/oauth2/universal2/token",dataType:"json",data:{app_id:y,grant_type:"authorization_code",redirect_uri:"http://localhost:8080",code:n,code_verifier:"1649285048042"},success:function(a){r=a,_(r)},error:function(){alert("Get token errorz")}})}t(e("chooseAsset")).click(n=>{v.show();let a=n.target.dataset.field,i=n.target.dataset.element,c=n.target.dataset.type,l=n.target.dataset.access;w(a,i,c,l)}),t(e("removeDamAsset")).click(n=>{t(e("chooseAsset")).html("Add a DAM Asset"),t(s).hide(),t(e("cantoId")).val(null),t(e("cantoAssetData")).val([])}),window.addEventListener("message",n=>{const a=n.data;if(t(o).attr("data-field")==this.options.fieldId)if(a&&a.type=="getTokenInfo"){var i=document.getElementById(o.slice(1)).contentWindow;r.formatDistrict=p,i.postMessage(r,"*")}else if(a&&a.type=="cantoLogout")r={},t(".canto-uc-iframe-close-btn").trigger("click");else if(a&&a.type=="cantoInsertImage")t(".canto-uc-iframe-close-btn").trigger("click"),callback(b,a.assetList);else if(a&&a.type=="closeModal"){let c=a.cantoAssetData[0];const l=a.cantoAssetData.length;t(s).attr("data-assetCount",l),t(s).attr("data-thumbnailUrl",c.directUri),t(s).attr("data-thumbnailName",c.displayName),d(),t(e("cantoId")).val(a.cantoId),t(e("cantoAssetData")).val(JSON.stringify(a.cantoAssetData)),t(s).show(),v.hide()}else a&&u(a)})})}},t.fn[m]=function(e){return this.each(function(){t.data(this,"plugin_"+m)||t.data(this,"plugin_"+m,new g(this,e))})};function A(e){h=e.env,p=e.extensions}const o="#cantoDamAssetsUCFrame";let k=t(`
                <div class="modal"> <!-- modal body -->
                    <div class="body modal-test" style="padding: 0;"> <!-- modal-content -->
                        <header class="header" style="padding: 48px 48px 24px; margin: -24px -24px 0px;">
                            <h2>Canto Assets</h2>
                        </header>
                        <iframe id="${o.slice(1)}" class="canto-uc-subiframe" src=""></iframe>
                        <div class="modal-status-bar">Uploading Image...</div>
                    </div>
                </div>
                `),v=new Garnish.Modal(k,{autoShow:!1});function w(e,s,d,u){let n={accessToken:u},a="https://oauth.canto.com/oauth/api/oauth2/universal2/authorize?response_type=code&app_id=52ff8ed9d6874d48a3bef9621bc1af26&redirect_uri=http://localhost:8080&state=abcd&code_challenge=1649285048042&code_challenge_method=plain";var i="/admin/_canto-dam-assets/canto-embed.twig";n.accessToken?(t(o).attr("data-element",s),t(o).attr("data-field",e),t(o).attr("data-type",d),t(o).attr("data-access",n.accessToken),t(o).attr("src",i)):(t(o).attr("data-element",s),t(o).attr("data-field",e),t(o).attr("data-type",d),t(o).attr("src",a))}function _(e){t.ajax({type:"GET",url:"https://oauth."+h+":443/oauth/api/oauth2/tenant/"+e.refreshToken,success:function(s){e.tenant=s,t(o).attr("src","/admin/_canto-dam-assets/canto-embed.twig")},error:function(){alert("Get tenant error")}})}})(jQuery);
//# sourceMappingURL=canto-field-9febe2d6.js.map
