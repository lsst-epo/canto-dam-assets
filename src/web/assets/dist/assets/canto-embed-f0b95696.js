let g="",p="",m="",s={},f={},h="",u=[],k=50,v=0,r=!1,w="";const x=100,A=1e3;function M(e){g=e.accessToken,m=e.tenant,p=e.tokenType?e.tokenType:"bearer",f={Authorization:p+" "+g,"Content-Type":"application/x-www-form-urlencoded"},w=e.formatDistrict}s.loadTree=function(e){var a="https://"+m+"/api/v1/tree?sortBy=name&sortDirection=ascending&layer=1";$.ajax({headers:f,type:"GET",url:a,async:!0,error:function(n){alert("load tree error")},success:function(n){e(n.results)}})};s.loadSubTree=function(e,a){let n=`https://${m}/api/v1/tree/${e}`;$.ajax({headers:f,type:"GET",url:n,async:!0,error:function(t){alert("load tree error")},success:function(t){a(t.results)}})};s.getListByAlbum=function(e,a){if(r)return;let n=T(k),t=`https://${m}/api/v1/album/${e}?${n}`;$.ajax({type:"GET",headers:f,url:t,async:!0,error:function(o){alert("load list error")},success:function(o){u.push.apply(u,o.results),o.start||(o.start=0),o.found-o.limit<=o.start?r=!0:r=!1,v=o.start+o.limit+1,$("#loadingMore").delay(1500).fadeOut("slow"),a(o.results)}})};s.getRedirectURL=function(e,a){if(!(e&&a))return;let n=e+"URI";$.ajax({type:"GET",headers:f,url:n,error:function(t){console.error(t.getError())},success:function(t){$("img#"+a).attr("src",t)}})};s.getHugeRedirectURL=function(e,a){if(!(e&&a))return;let n=`${e}URI/2000`;$.ajax({type:"GET",headers:f,url:n,error:function(t){console.error(t.getError())},success:function(t){$("#cantoViewBody").find("#imageBox").find("img").attr("src",t)}})};s.getListByScheme=function(e,a){if(e=="allfile"){let n={scheme:"allfile",keywords:""};s.getFilterList(n,a)}else{if(r)return;let n=T(k),t=`https://${m}/api/v1/${e}?${n}`;$.ajax({type:"GET",headers:f,url:t,async:!1,error:function(o){alert("load list error")},success:function(o){u.push.apply(u,o.results),o.start||(o.start=0),o.found-o.limit<=o.start?r=!0:r=!1,v=o.start+o.limit+1,$("#loadingMore").delay(1500).fadeOut("slow"),a(o.results)}})}};s.getDetail=function(e,a,n){let t=`https://${m}/api/v1/${a}/${e}`;$.ajax({type:"GET",headers:f,url:t,async:!0,error:function(o){alert("load detail error")},success:function(o){n(o)}})};s.getFilterList=function(e,a){if(r)return;let n=T(k),t=`https://${m}/api/v1/search?${n}`;t+=`&keyword=${e.keywords}`,e.scheme&&e.scheme=="allfile"?t+=`&scheme=${encodeURIComponent("image|presentation|document|audio|video|other")}`:e.scheme&&(t+=`&scheme=${e.scheme}`),$.ajax({type:"GET",headers:f,url:t,async:!1,error:function(o){alert("load List error")},success:function(o){u.push.apply(u,o.results),o.start||(o.start=0),o.found-o.limit<=o.start?r=!0:r=!1,v=o.start+o.limit+1,$("#loadingMore").delay(1500).fadeOut("slow"),a(o.results)}})};s.logout=function(){let e=parent,a={};a.type="cantoLogout",e.postMessage(a,"*")};s.paginatedAlbumRequest=async(e,a,n=0)=>{let t=`https://${m}/api/v1/album/${a}`,o="sortBy=time&sortDirection=descending&limit="+A+"&start="+n,l=await fetch(`${t}?${o}`,{method:"get",headers:{Authorization:`${p} ${g}`,"Content-Type":"application/json; charset=utf-8"}}).then(c=>c.json());return e.push(...l.results),e.length<l.found?s.paginatedAlbumRequest(e,a,n+A):e};s.paginatedContentRequest=async(e,a,n=0)=>{let t=`https://${m}/api/v1/batch/content`;const o=a.slice(n,n+x);let l=await fetch(t,{method:"post",headers:{Authorization:`${p} ${g}`,"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(o)}).then(c=>c.json());return e.push(...l.docResult),e.length<a.length?s.paginatedContentRequest(e,a,n+x):e};s.insertImage=function(e){e&&e.length&&s.paginatedContentRequest([],e,0).then(a=>{let n=a.length===1?a[0].id:0,t=$("#treeviewSection").find("li.selected");const o=t.data("id");let l=t.find("span").text(),d={type:"closeModal",cantoId:n,cantoAlbumId:0,cantoAssetData:a,cantoAlbumData:{id:o,name:l}};parent.postMessage(d,"*")}).catch(a=>{console.error(a.message),data.type="cantoInsertImage",data.assetList=[],parent.postMessage(data,"*")})};s.insertAlbum=function(e,a){s.paginatedAlbumRequest([],e,0).then(n=>{let o={type:"closeModal",cantoId:0,cantoAlbumId:e,cantoAssetData:n,cantoAlbumData:{id:e,name:a}};parent.postMessage(o,"*")}).catch(n=>{console.error(n.message),data.type="cantoInsertImage",data.assetList=[],parent.postMessage(data,"*")})};$(document).ready(function(){E(),z(),R(),window.addEventListener("message",e=>{let a=e.data;a&&a.accessToken&&a.accessToken.length>0?M(a):M({accessToken:parent.document.querySelector(".canto-uc-subiframe").dataset.access,tenant:parent.document.querySelector(".canto-uc-subiframe").dataset.tenant}),D();let n=$("#cantoViewBody").find(".type-font.current").data("type");$("#cantoViewBody").find("#globalSearch input").val(""),C(n)})});function R(){let e=parent,a={};a.type="getTokenInfo",e.postMessage(a,"*")}function E(){let e=document.getElementsByClassName("canto-uc-subiframe")[0];e&&e.contentDocument}function z(){document.addEventListener("sendTokenInfo",function(n){let t=n.data;g=t.accessToken,t.refreshToken,p=t.tokenType}),$(document).off("click").on("change","#uploadBtnInvisible",n=>{N(n)}).on("click","#uploadBtn",n=>{document.querySelector("#uploadBtnInvisible").click()}).on("click","#treeviewSwitch",function(n){$("#treeviewSection").hasClass("expanded")?($("#treeviewSection").stop().animate({left:"-20%"}),$("#cantoImageBody").stop().animate({width:"100%",left:"0"},B),$("#treeviewSection").removeClass("expanded"),$("#loadingMore").addClass("no-treeview"),$("#noItem").addClass("no-treeview"),$(".max-select-tips").addClass("no-treeview")):($("#treeviewSection").stop().animate({left:"0px"}),$("#cantoImageBody").stop().animate({width:"80%",left:"20%"},B),$("#treeviewSection").addClass("expanded"),$("#loadingMore").removeClass("no-treeview"),$("#noItem").removeClass("no-treeview"),$(".max-select-tips").removeClass("no-treeview"))}).on("click",".type-font",function(n){h="byScheme",$(".type-font").removeClass("current"),$(this).addClass("current"),$("#cantoViewBody").find("#globalSearch input").val(""),$("#cantoViewBody").find("#treeviewSection ul li").removeClass("selected");let t={};t.scheme=$("#cantoViewBody").find(".type-font.current").data("type"),t.keywords="",$("#cantoViewBody").find("#imagesContent").html(""),$("#cantoViewBody").find("#imagesContent").scrollTop(0),r=!1,u=[],s.getFilterList(t,y)}).on("click","#selectAllBtn",function(n){$("#cantoViewBody").find(".single-image .select-box").removeClass("icon-s-Ok2_32"),$("#cantoViewBody").find(".single-image").removeClass("selected"),S()}).on("click","#insertAssetsBtn",function(n){$("#cantoViewBody").find(".loading-icon").removeClass("hidden");let t=[],o=$("#cantoViewBody").find(".single-image .icon-s-Ok2_32").closest(".single-image");for(let l=0;l<o.length;l++){let c={};c.id=$(o[l]).data("id"),c.scheme=$(o[l]).data("scheme"),t.push(c)}s.insertImage(t)}).on("click","#insertAlbumBtn",function(n){$("#cantoViewBody").find(".loading-icon").removeClass("hidden");let t=$("#treeviewSection").find("li.selected");const o=t.data("id");let l=t.find("span").text();s.insertAlbum(o,l)}).on("click",".icon-s-Fullscreen",function(n){n.cancelBubble=!0,n.stopPropagation(),n.preventDefault(),$("#cantoViewBody").find(".loading-icon").removeClass("hidden");let o=$(n.currentTarget).closest(".single-image").data("xurl")+"?Authorization="+g;q(o)}).on("click",".single-image",function(n){$("#cantoViewBody").find(".loading-icon").removeClass("hidden");let t=$(n.currentTarget).closest(".single-image").data("xurl"),o=$(n.currentTarget).closest(".single-image").data("id");s.getHugeRedirectURL(t,o);let l=$(this).data("id"),c=$(this).data("scheme");s.getDetail(l,c,O)}).on("click","#logoutBtn",function(n){$(".loading-icon").removeClass("hidden"),s.logout()}).on("click","#treeviewSection ul li",function(n){n.cancelBubble=!0,n.stopPropagation(),n.preventDefault();let t=$(n.currentTarget).children("ul");if($(n.currentTarget)[0].id=="treeviewContent")$("#cantoViewBody").find("#globalSearch input").val(""),$("#cantoViewBody").find("#treeviewSection ul li").removeClass("selected"),$("#cantoViewBody").find(".type-font").removeClass("current"),$("#cantoViewBody").find("#imagesContent").html(""),$("#cantoViewBody").find("#imagesContent").scrollTop(0),u=[],h="",r=!1,C("allfile");else if(t&&t.length)t.animate({height:"toggle"});else if($(n.currentTarget).hasClass("has-sub-folder")){let o=$(n.currentTarget).data("id");$(n.currentTarget).addClass("current-tree-node"),$(n.currentTarget).find(".folder-loading").removeClass("hidden"),$(n.currentTarget).find(".icon-s-Folder_open-20px").addClass("hidden"),s.loadSubTree(o,P)}else{$("#treeviewSection ul li").removeClass("selected"),$("#cantoViewBody").find(".type-font").removeClass("current"),$("#insertAlbumWrapper").removeClass("hidden"),$(n.currentTarget).addClass("selected"),$("#cantoViewBody").find("#globalSearch input").val(""),$("#cantoViewBody").find("#imagesContent").html(""),$("#cantoViewBody").find("#imagesContent").scrollTop(0),u=[],r=!1,h="bytree";let o=$(n.currentTarget).data("id");s.getListByAlbum(o,y)}}).on("click","#globalSearchBtn",function(n){let t=$("#cantoViewBody").find("#globalSearch input").val();if(!t){$("#cantoViewBody").find("#treeviewSection ul li").removeClass("selected");let c=$("#cantoViewBody").find(".type-font.current").data("type");$("#cantoViewBody").find("#globalSearch input").val(""),$("#cantoViewBody").find("#imagesContent").html(""),$("#cantoViewBody").find("#imagesContent").scrollTop(0),u=[],h="",r=!1,C(c)}h="bySearch",r=!1,$("#cantoViewBody").find("#treeviewSection ul li").removeClass("selected"),$("#cantoViewBody").find(".type-font").removeClass("current");let o=$("#cantoViewBody").find(".type-font.current").data("type"),l={};l.scheme=o,l.keywords=t,$("#cantoViewBody").find("#imagesContent").html(""),$("#cantoViewBody").find("#imagesContent").scrollTop(0),u=[],s.getFilterList(l,y)}),$("#cantoViewBody").find("#cantoImageBody").on("scroll",function(){H()&&!r&&L()});let e=$("#cantoViewBody").find("#globalSearch input");$(e).bind("keyup",function(n){n.keyCode=="13"&&$("#cantoViewBody").find("#globalSearchBtn").click()});let a=$("#cantoViewBody").find("#cantoImageBody");$(a).resize(function(){B()})}function C(e){s.getListByScheme(e,y)}function y(e){if(!(e&&e.length>0))return;let a=[];w&&w.length>1&&(a=w.split(";"));for(let c=0;c<e.length;c++){let d=e[c],b=d.name.substring(d.name.lastIndexOf(".")+1);if(a.length&&!a.includes(b))continue;let V="",I=d.name;d.name.length>150&&(I=d.name.substr(0,142)+"..."+d.name.substr(-5)),V+=`<div class="single-image" data-id="${d.id}" data-scheme="${d.scheme}" data-xurl="${d.url.preview}" data-name="${d.name}" data-size="${d.size}" >
                    <img id="${d.id}" loading="lazy" src="https://s3-us-west-2.amazonaws.com/static.dmc/universal/icon/back.png" alt="${d.scheme}">
                    <div class="mask-layer"></div>
                    <div class="single-image-name">${I}</div>
                    <span class="select-box icon-s-UnselectedCheck_32  "></span><span class="select-icon-background"></span>
                </div>`,$("#cantoViewBody").find("#imagesContent").append(V),s.getRedirectURL(d.url.preview,d.id)}$("#cantoViewBody").find(".single-image").length==0?$("#cantoViewBody").find("#noItem").removeClass("hidden"):$("#cantoViewBody").find("#noItem").addClass("hidden");let t=[];$("#cantoViewBody").find(".single-image").hover(function(){let c=$(this).height()-$(this).find(".single-image-name").height()-20;$(this).find(".single-image-name").stop().animate({top:c})},function(){$(this).find(".single-image-name").stop().animate({top:"100%"})}),$("#cantoViewBody").find(".single-image .select-box").off("click").on("click",function(c){if(c.cancelBubble=!0,c.stopPropagation(),c.preventDefault(),t.push($(".single-image").index($(this).closest(".single-image"))),c.shiftKey){let d=Math.min(t[t.length-2],t[t.length-1]),b=Math.max(t[t.length-2],t[t.length-1]);for(i=d;i<=b;i++){if($("#cantoViewBody").find(".single-image .icon-s-Ok2_32").length>=20){$(".max-select-tips").fadeIn("normal").delay(2e3).fadeOut(1e3);return}$(".single-image:eq("+i+") .select-box").addClass("icon-s-Ok2_32"),$(".single-image:eq("+i+")").addClass("selected")}}else if($("#cantoViewBody").find(".single-image .icon-s-Ok2_32").length>=20){$(this).hasClass("icon-s-Ok2_32")||$(".max-select-tips").fadeIn("normal").delay(2e3).fadeOut(1e3),$(this).removeClass("icon-s-Ok2_32"),$(this).closest(".single-image").removeClass("selected");return}else $(this).toggleClass("icon-s-Ok2_32"),$(this).closest(".single-image").toggleClass("selected");S()}),B(),S();let o=$("#cantoImageBody").height();$("#imagesContent").height()<o&&!r&&L()}let S=function(){let e=$("#cantoViewBody").find(".single-image .icon-s-Ok2_32").length;$("#cantoViewBody").find("#selected-count").html(e),e?($("#cantoViewBody").find("#globalSearch").addClass("hidden"),$("#cantoViewBody").find("#filterSection").addClass("hidden"),$("#cantoViewBody").find("#selectedCountSection").removeClass("hidden"),$("#cantoViewBody").find("#selectedActionSection").removeClass("hidden"),$("#insertAlbumWrapper").addClass("hidden")):($("#cantoViewBody").find("#globalSearch").removeClass("hidden"),$("#cantoViewBody").find("#filterSection").removeClass("hidden"),$("#cantoViewBody").find("#selectedCountSection").addClass("hidden"),$("#cantoViewBody").find("#selectedActionSection").addClass("hidden"),$("#insertAlbumWrapper").removeClass("hidden")),$("#cantoViewBody").find("#selectAllBtn").addClass("all-selected"),$("#cantoViewBody").find("#selectAllBtn").attr("title","Deselect All")};function q(e){let a=$("#cantoViewBody").find("#viewImageModal"),n=$("#cantoViewBody").find("#pageMask");a.find("img").attr("src",e),$("#cantoViewBody").find(".loading-icon").addClass("hidden"),a.removeClass("hidden"),n.removeClass("hidden"),$("#cantoViewBody").find(".view-image-modal .close-btn").off("click").on("click",function(){a.addClass("hidden"),n.addClass("hidden")})}function O(e){let a=function(t,o,l){if(t)$(o).closest(".detail-item").removeClass("hidden");else return $(o).closest(".detail-item").addClass("hidden"),"Null";return l||(l=150),t.length>l?($(o).removeClass("hidden"),t.slice(0,l)+"..."):($(o).addClass("hidden"),t)};if(e){$("#cantoViewBody").find("#imagebox_name").html(e.name),$("#cantoViewBody").find("#imagebox_size").html(Math.round(e.size/1024)+"KB"),$("#cantoViewBody").find("#imagebox_created").html(e.metadata&&e.metadata["Create Date"]?e.metadata["Create Date"]:" "),$("#cantoViewBody").find("#imagebox_uploaded").html(j(e.lastUploaded)),$("#cantoViewBody").find("#imagebox_status").html(e.approvalStatus);let t=$("#imagebox_copyright").closest(".detail-item").find(".more");$("#cantoViewBody").find("#imagebox_copyright").html(a(e.copyright,t,177)),$("#cantoViewBody").find("#imagebox_copyright").data("field",e.copyright);let o=$("#imagebox_tac").closest(".detail-item").find(".more");$("#cantoViewBody").find("#imagebox_tac").html(a(e.termsAndConditions,o,160)),$("#cantoViewBody").find("#imagebox_tac").data("field",e.termsAndConditions),$("#cantoViewBody").find("#insertBtn").data("id",e.id),$("#cantoViewBody").find("#insertBtn").data("scheme",e.scheme)}let n=$("#cantoViewBody").find("#imagePreviewModal");$("#cantoViewBody").find(".loading-icon").addClass("hidden"),n.removeClass("hidden"),$("#cantoViewBody").find("#imagePreviewModal .close-btn").off("click").on("click",function(){n.addClass("hidden")}),$("#cantoViewBody").find("#imagePreviewModal #cancelBtn").off("click").on("click",function(){n.addClass("hidden")}),$("#cantoViewBody").find("#imagePreviewModal .detail-item .more").off("click").on("click",function(){let t=$(this).closest(".detail-item").find(".content").data("field");$(this).closest(".detail-item").find(".content").html(t),$(this).addClass("hidden")}),$("#cantoViewBody").find("#imagePreviewModal #insertBtn").off("click").on("click",function(){$("#cantoViewBody").find(".loading-icon").removeClass("hidden");let t=[{id:e.id,scheme:e.scheme}];s.insertImage(t)})}function j(e){return e.substr(0,4)+"-"+e.substr(4,2)+"-"+e.substr(6,2)+" "+e.substr(8,2)+":"+e.substr(10,2)}function D(){s.loadTree(U)}let U=function(e){let a="";a=F(e),$("#cantoViewBody").find("#treeviewContent").append(a),$("#cantoViewBody").find("#treeviewContent > ul").animate({height:"toggle"})},F=function(e){let a="<ul style='display: none;'>";return $.each(e,function(n,t){let o=" ";t.size==0?o="no-child":t.scheme=="folder"&&(o="has-sub-folder"),a+=`<li data-id="${t.id}"  class="${o}">`;let l="icon-s-Folder_open-20px";t.scheme=="album"&&(l="icon-s-Album-20px"),a+=`<i class="${l}"></i>
                    <img src="https://s3-us-west-2.amazonaws.com/static.dmc/universal/icon/cantoloading.gif" class="folder-loading hidden" alt="Loading">
                    <span>${t.name}</span>
                </li>`}),a+="</ul>",a},P=function(e){let a=_(e);$("#cantoViewBody").find(".current-tree-node").append(a),$("#cantoViewBody").find(".current-tree-node > ul").animate({height:"toggle"}),$("#cantoViewBody").find(".current-tree-node").find(".folder-loading").addClass("hidden"),$("#cantoViewBody").find(".current-tree-node").find(".icon-s-Folder_open-20px").removeClass("hidden"),$("#cantoViewBody").find(".current-tree-node").removeClass("current-tree-node")},_=function(e){let a="<ul style='display: none;'>";return $.each(e,function(n,t){let o=" ";t.size==0&&(o="no-child"),a+=`<li data-id="${t.id}"  class="${o}">`;let l="icon-s-Folder_open-20px";t.scheme=="album"&&(l="icon-s-Album-20px"),a+=`<i class="${l}"></i>
                    <span>${t.name}</span>`,t.children&&t.children.length&&(a+=_(t.children)),a+="</li>"}),a+="</ul>",a};function B(){let e=8,a=Number($("#cantoViewBody").find("#imagesContent")[0].offsetWidth),n=0,t=function(l){if(n=Number((a-8)/l-2),n>=160&&n<=210)return n;n<160?(l--,t(l)):n>210&&(l++,t(l))},o=t(e);$("#cantoViewBody").find(".single-image").css("width",o)}function H(){let e=$("#cantoImageBody").height(),a=$("#imagesContent").height(),n=$("#cantoImageBody").scrollTop(),t=a-e-n<0,o=$(".single-image").length==0;return t&&!o}function T(e){let a=u.length==0?0:v,n="sortBy=time&sortDirection=descending&limit="+e+"&start="+a;return $(".single-image").length!==0?$("#loadingMore").fadeIn("slow"):$("#cantoViewBody").find("#imagesContent").html(""),n}function L(){if(h=="bySearch"){let e=$("#cantoViewBody").find("#globalSearch input").val();if(!e)return;let a=$("#cantoViewBody").find(".type-font.current").data("type"),n={};n.scheme=a,n.keywords=e,s.getFilterList(n,y)}else if(h=="bytree"){let e=$("#cantoViewBody").find("#treeviewSection ul li").find(".selected").data("id");s.getListByAlbum(e,y)}else{let e=$("#cantoViewBody").find(".type-font.current").data("type");C(e)}}function N(e){let a=`https://${m}/api/v1/upload/setting`;fetch(a,{method:"GET",headers:{Authorization:`${p} ${g}`,"Content-Type":"application/json; charset=utf-8"}}).then(t=>t.json()).then(t=>{const o=new FormData;o.append("key",t.key),o.append("acl",t.acl),o.append("AWSAccessKeyId",t.AWSAccessKeyId),o.append("Policy",t.Policy),o.append("Signature",t.Signature),o.append("x-amz-meta-file_name",e.currentTarget.files[0].name),o.append("x-amz-meta-tag",""),o.append("x-amz-meta-scheme",""),o.append("x-amz-meta-id",""),o.append("x-amz-meta-album_id",""),o.append("file",e.currentTarget.files[0]),parent.document.querySelector(".modal-status-bar"),fetch(t.url,{method:"post",body:o,mode:"no-cors",redirect:"follow"}).then(l=>{document.getElementById("uploadBtn").style.background="linear-gradient(16deg, rgb(205 101 1) 0%, rgb(169 218 0 / 100%) 100%)",document.getElementById("uploadBtn").value="Uploading image..."}).catch(l=>{console.log(l)}).finally(()=>{document.getElementById("uploadBtn").value="Upload complete - processing",n(e.currentTarget.files[0].name)})}).catch(t=>{console.log("An error occurred while attempting to grab upload settings!"),console.log(t)});function n(t){let o=`https://${m}/api/v1/upload/status?hours=1`;parent.document.querySelector(".modal-status-bar"),setInterval(()=>{fetch(o,{method:"get",headers:{Authorization:p+" "+g}}).then(l=>l.json()).then(l=>{l.results&&l.results.length>0&&l.results.filter(d=>{if(d.name==t&&d.status!="Done")return d}).filter(d=>d!=null).length==0&&(document.getElementById("uploadBtn").value="Canto processing complete! Reloading",window.location.reload())}).catch(l=>{console.log("an error occurred!"),console.log(l)})},5e3)}}parent.document.querySelector(".modal-status-bar").style.display="none";
//# sourceMappingURL=canto-embed-f0b95696.js.map
