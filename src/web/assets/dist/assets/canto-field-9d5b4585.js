(function(t){let d={},m="canto.com",v="52ff8ed9d6874d48a3bef9621bc1af26",y,u;const l="CantoDamConnector",h={env:"canto.com"};function p(s,n){this.element=s,this.options=t.extend({},h,n),this._defaults=h,this._name=l,this.init()}p.prototype={init:function(){t(()=>{b(this.options);const s=e=>"#fields-"+Craft.namespaceId(e,this.options.id),n=s("damAssetPreview");f();function f(){const e=s("damAssetPreviewWrapper");if(t(e).remove(),t(n).attr("data-thumbnailurl")==null||t(n).attr("data-thumbnailurl")=="none")t(n).hide();else{const a=t(n).attr("data-thumbnailurl");let c=t(n).attr("data-thumbnailName");const i=t(n).attr("data-assetCount"),r=i==1?"":"canto-asset-preview-stack";c=i==1?c:`${i} images`,t(s("chooseAsset")).html("Choose a Different DAM Asset"),t(n).prepend(`
<div id="${e.slice(1)}">
<img class="${r}" style="max-height:200px; max-width:200px;" src=${a}>
<span>${c}</span><br />
</div>
`)}}const o=s("cantoUCFrame");let A=t(`
                <div class="modal"> <!-- modal body -->
                    <div class="body modal-test" style="padding: 0;"> <!-- modal-content -->
                        <header class="header" style="padding: 48px 48px 24px; margin: -24px -24px 0px;">
                            <h2>Canto Assets</h2>
                        </header>
                        <iframe id="${o.slice(1)}" class="canto-uc-subiframe" src=""></iframe>
                        <div class="modal-status-bar">Uploading Image...</div>
                    </div>
                </div>
                `),g=new Garnish.Modal(A,{autoShow:!1});function k(e,a,c,i){let r={accessToken:i},C="https://oauth.canto.com/oauth/api/oauth2/universal2/authorize?response_type=code&app_id=52ff8ed9d6874d48a3bef9621bc1af26&redirect_uri=http://localhost:8080&state=abcd&code_challenge=1649285048042&code_challenge_method=plain";var I="/admin/_canto-dam-assets/canto-embed.twig";r.accessToken?(t(o).attr("data-element",a),t(o).attr("data-field",e),t(o).attr("data-type",c),t(o).attr("data-access",r.accessToken),t(o).attr("src",I)):(t(o).attr("data-element",a),t(o).attr("data-field",e),t(o).attr("data-type",c),t(o).attr("src",C))}function w(e){t.ajax({type:"GET",url:"https://oauth."+m+":443/oauth/api/oauth2/tenant/"+e.refreshToken,success:function(a){e.tenant=a,t(o).attr("src","/admin/_canto-dam-assets/canto-embed.twig")},error:function(){alert("Get tenant error")}})}function _(e){t.ajax({type:"POST",url:"https://oauth.canto.com/oauth/api/oauth2/universal2/token",dataType:"json",data:{app_id:v,grant_type:"authorization_code",redirect_uri:"http://localhost:8080",code:e,code_verifier:"1649285048042"},success:function(a){d=a,w(d)},error:function(){alert("Get token errorz")}})}t(s("chooseAsset")).click(function(e){g.show();let a=e.target.dataset.field,c=e.target.dataset.element,i=e.target.dataset.type,r=e.target.dataset.access;k(a,c,i,r)}),t(s("removeDamAsset")).click(e=>{t(s("chooseAsset")).html("Add a DAM Asset"),t(n).hide(),t(s("cantoId")).val(null),t(s("cantoAssetData")).val([])}),window.onmessage=e=>{var a=e.data;if(a&&a.type=="getTokenInfo"){var c=document.getElementById(o.slice(1)).contentWindow;d.formatDistrict=u,c.postMessage(d,"*")}else if(a&&a.type=="cantoLogout")d={},t(".canto-uc-iframe-close-btn").trigger("click");else if(a&&a.type=="cantoInsertImage")t(".canto-uc-iframe-close-btn").trigger("click"),callback(y,a.assetList);else if(a&&a.type=="closeModal"){let i=a.cantoAssetData[0];const r=a.cantoAssetData.length;t(n).attr("data-assetCount",r),t(n).attr("data-thumbnailUrl",i.directUri),t(n).attr("data-thumbnailName",i.name),f(),t(s("cantoId")).val(a.cantoId),t(s("cantoAssetData")).val(JSON.stringify(a.cantoAssetData)),t(n).show(),g.hide()}else a&&_(a)}})}},t.fn[l]=function(s){return this.each(function(){t.data(this,"plugin_"+l)||t.data(this,"plugin_"+l,new p(this,s))})};function b(s){m=s.env,u=s.extensions}})(jQuery);
//# sourceMappingURL=canto-field-9d5b4585.js.map
