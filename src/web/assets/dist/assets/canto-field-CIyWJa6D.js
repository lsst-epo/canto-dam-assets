(function(t){let d={},f,g,p,C,v;const r="CantoDamConnector",b={env:"canto.com"};function y(a,n){this.element=a,this.options=t.extend({},b,n),this._defaults=b,this._name=r,this.init()}y.prototype={init:function(){t(()=>{I(this.options);const a=o=>"#"+this.options.prefix+"-"+Craft.namespaceId(o,this.options.id),n=a("damAssetPreview");function m(){const o=a("damAssetPreviewWrapper");if(t(o).remove(),t(n).attr("data-thumbnailurl")==null||t(n).attr("data-thumbnailurl")=="none")t(n).hide();else{const e=t(n).attr("data-thumbnailurl"),l=t(n).attr("data-albumName");let i=t(n).attr("data-thumbnailName");const c=t(n).attr("data-assetCount"),u=c==1?"":"canto-asset-preview-stack";i=c==1?i:`${c} images`,l.length&&(i+=" / "+l),t(a("chooseAsset")).html("Choose a Different DAM Asset"),t(n).prepend(`
<div id="${o.slice(1)}">
<img class="${u}" style="max-height:200px; max-width:200px;" src=${e}>
<span>${i}</span><br />
</div>
`)}}function h(o){t.ajax({type:"POST",url:"https://oauth.canto.com/oauth/api/oauth2/universal2/token",dataType:"json",data:{app_id:g,grant_type:"authorization_code",redirect_uri:"http://localhost:8080",code:o,code_verifier:"1649285048042"},success:function(e){d=e,_(d)},error:function(){alert("Get token errorz")}})}t(a("chooseAsset")).click(o=>{A.show();let e=o.target.dataset.field,l=o.target.dataset.element,i=o.target.dataset.type,c=o.target.dataset.access;D(e,l,i,c,this.options.bodyClass)}),t(a("removeDamAsset")).click(o=>{t(a("chooseAsset")).html("Add a DAM Asset"),t(n).hide(),t(a("cantoId")).val(null),t(a("cantoAlbumId")).val(null),t(a("cantoAssetData")).val([]),t(a("cantoAlbumData")).val([])}),window.addEventListener("message",o=>{const e=o.data;if(t(s).attr("data-field")==this.options.fieldId)if(e&&e.type=="getTokenInfo"){var l=document.getElementById(s.slice(1)).contentWindow;d.formatDistrict=v,d.tenant=p,l.postMessage(d,"*")}else if(e&&e.type=="cantoLogout")d={},t(".canto-uc-iframe-close-btn").trigger("click");else if(e&&e.type=="cantoInsertImage")t(".canto-uc-iframe-close-btn").trigger("click"),callback(C,e.assetList);else if(e&&e.type=="closeModal"){let i=e.cantoAssetData[0];const c=e.cantoAssetData.length;t(n).attr("data-assetCount",c),t(n).attr("data-thumbnailUrl",i.url.directUrlPreview),t(n).attr("data-thumbnailName",i.name),t(n).attr("data-albumName",e.cantoAlbumData.name),m(),t(a("cantoId")).val(e.cantoId),t(a("cantoAlbumId")).val(e.cantoAlbumId),t(a("cantoAssetData")).val(JSON.stringify(e.cantoAssetData)),t(a("cantoAlbumData")).val(JSON.stringify(e.cantoAlbumData)),t(n).show(),A.hide()}else e&&h(e)})})}},t.fn[r]=function(a){return this.each(function(){t.data(this,"plugin_"+r)||t.data(this,"plugin_"+r,new y(this,a))})};function I(a){f=a.env,g=a.appId,p=a.tenantHostName,v=a.extensions}const s="#cantoDamAssetsUCFrame";let w=t(`
                <div class="modal"> <!-- modal body -->
                    <div class="body modal-test" style="padding: 0;"> <!-- modal-content -->
                        <header class="header" style="padding: 48px 48px 24px; margin: -24px -24px 0px;">
                            <h2>Canto Assets</h2>
                        </header>
                        <iframe id="${s.slice(1)}" class="canto-uc-subiframe" src=""></iframe>
                        <div class="modal-status-bar">Uploading Image...</div>
                    </div>
                </div>
                `),A=new Garnish.Modal(w,{autoShow:!1});function D(a,n,m,h,o){let e={accessToken:h,tenant:p},l="https://oauth.canto.com/oauth/api/oauth2/universal2/authorize?response_type=code&app_id=52ff8ed9d6874d48a3bef9621bc1af26&redirect_uri=http://localhost:8080&state=abcd&code_challenge=1649285048042&code_challenge_method=plain";var i="/admin/_canto-dam-assets/canto-embed.twig";e.accessToken?(t(s).attr("data-element",n),t(s).attr("data-field",a),t(s).attr("data-type",m),t(s).attr("data-access",e.accessToken),t(s).attr("data-tenant",e.tenant),t(s).attr("src",i)):(t(s).attr("data-element",n),t(s).attr("data-field",a),t(s).attr("data-type",m),t(s).attr("src",l));function c(){const u=t(s).contents().find("body");u.removeClass("can-select-single can-select-multiple can-select-album"),u.addClass(o)}t(s).on("load",c),c()}function _(a){t.ajax({type:"GET",url:"https://oauth."+f+":443/oauth/api/oauth2/tenant/"+a.refreshToken,success:function(n){a.tenant=n,t(s).attr("src","/admin/_canto-dam-assets/canto-embed.twig")},error:function(){alert("Get tenant error")}})}})(jQuery);$(document).ready(function(){const t=new CustomEvent("vite-script-loaded",{detail:{path:"src/js/canto-field.js"}});document.dispatchEvent(t)});
//# sourceMappingURL=canto-field-CIyWJa6D.js.map
