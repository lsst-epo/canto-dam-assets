{"version":3,"file":"canto-field-968dac5a.js","sources":["../../../../../buildchain/src/js/canto-field.js"],"sourcesContent":["console.log(\"inside of /resources/script.js!!!\");\n\nif ($(\"#fields-dam-asset-preview\").attr(\"data-thumbnailurl\") == null ||\n  $(\"#fields-dam-asset-preview\").attr(\"data-thumbnailurl\") == \"none\") {\n  $(\"#fields-dam-asset-preview\").hide();\n} else {\n  let url = $(\"#fields-dam-asset-preview\").attr(\"data-thumbnailurl\");\n  $(\"#fields-rosas-clicker\").html(\"Choose a Different DAM Asset\");\n  $(\"#fields-dam-asset-preview\").prepend(`<img id=\"fields-dam-preview-image\" style=\"max-height:200px; max-width:200px;\" src=${url}/>`);\n}\n\nlet modalMarkup = $(`\n                <div id=\"rosas-modal\" class=\"modal\"> <!-- modal body -->\n                    <div id=\"modal-test\" class=\"body\" style=\"padding: 0;\"> <!-- modal-content -->\n                        <header class=\"header\" style=\"padding: 48px 48px 24px; margin: -24px -24px 0px;\">\n                            <h2>Canto Assets</h2>\n                        </header>\n                        <iframe id=\"cantoUCFrame\" class=\"canto-uc-subiframe\" src=\"\"></iframe>\n                        <div id=\"modal-status-bar\">Uploading Image...</div>\n                    </div>\n                </div>\n                `);\nlet $modal = new Garnish.Modal(modalMarkup, {'autoShow': false});\n\nlet pluginName = \"cantoUC\";\nlet cantoUC,\n  callback;\n\n$(\"#fields-remove-dam-asset\").click(function (e) {\n  let fieldId = e.target.dataset.field;\n  let elementId = e.target.dataset.element;\n  let assetId = e.target.dataset.asset;\n  $.ajax({\n    type: \"POST\",\n    url: \"/canto-dam-integrator/dam-asset-removal\",\n    dataType: \"json\",\n    data: {\n      \"elementId\": elementId,\n      \"fieldId\": fieldId\n    },\n    success: function (data) {\n      let res = JSON.parse(data);\n      if (res.status == \"success\") {\n        $(\"#fields-rosas-clicker\").html(\"Add a DAM Asset\");\n        $(\"#fields-dam-asset-preview\").hide();\n      } else {\n        console.log(\"logging data!!!\");\n        console.log(data);\n        alert(\"An error occurred while attempting to remove the image, please try again later.\");\n      }\n    },\n    error: function (request) {\n      console.log(\"logging request!!!\");\n      console.log(request);\n      alert(\"An error occurred while attempting to remove the image, please try again later.\");\n    }\n  });\n});\n\n$(\"#fields-rosas-clicker\").click(function (e) {\n  $modal.show();\n  let fieldId = e.target.dataset.field;\n  let elementId = e.target.dataset.element;\n  let type = e.target.dataset.type;\n  let accessToken = e.target.dataset.access;\n  loadIframeContent(fieldId, elementId, type, accessToken);\n});\n\nfunction dynamicLoadCss(url) {\n  let head = document.getElementsByTagName('head')[0];\n  let link = document.createElement('link');\n  link.type = 'text/css';\n  link.rel = 'stylesheet';\n  link.href = url;\n  head.appendChild(link);\n}\n\n/*--------------------------load file---------------------------------------*/\nfunction dynamicLoadJs(url, callback) {\n  var head = document.getElementsByTagName('head')[0];\n  var script = document.createElement('script');\n  script.type = 'text/javascript';\n  script.src = url;\n  if (typeof (callback) == 'function') {\n    script.onload = script.onreadystatechange = function () {\n      if (!this.readyState || this.readyState === \"loaded\" || this.readyState === \"complete\") {\n        callback();\n        script.onload = script.onreadystatechange = null;\n      }\n    };\n  }\n  head.appendChild(script);\n}\n\ncantoUC = $.fn[pluginName] = $[pluginName] = function (options, callback) {\n  /*! options.env:   flightbycanto.com/staging.cantoflight.com/canto.com/canto.global\n  */\n  settings(options);\n  loadCantoUCResource();\n  // createIframe();\n  addEventListener();\n  initCantoTag();\n\n  window.onmessage = function (event) {\n    let data = event.data;\n    if (data && data.type == \"getTokenInfo\") {\n      let receiver = document.getElementById('cantoUCFrame').contentWindow;\n      tokenInfo.formatDistrict = formatDistrict;\n      receiver.postMessage(tokenInfo, '*');\n    } else if (data && data.type == \"cantoLogout\") {\n      //clear token and close the frame.\n      tokenInfo = {};\n      $(\".canto-uc-iframe-close-btn\").trigger(\"click\");\n\n    } else if (data && data.type == \"cantoInsertImage\") {\n      $(\".canto-uc-iframe-close-btn\").trigger(\"click\");\n      // insertImageToCantoTag(cantoURL);\n      callback(currentCantoTagID, data.assetList);\n\n    } else if (data && data.type == \"closeModal\") {\n      $modal.hide();\n    } else if (data) {\n      verifyCode = data;\n      // var cantoContentPage = \"https://s3-us-west-2.amazonaws.com/static.dmc/universal/cantoContent.html\";\n      getTokenByVerifycode(verifyCode);\n\n    }\n\n  };\n};\n\nfunction getTokenByVerifycode(verifyCode) {\n  $.ajax({\n    type: \"POST\",\n    url: \"https://oauth.canto.com/oauth/api/oauth2/universal2/token\",\n    dataType: \"json\",\n    data: {\n      \"app_id\": appId,\n      \"grant_type\": \"authorization_code\",\n      \"redirect_uri\": \"http://localhost:8080\",\n      \"code\": verifyCode,\n      \"code_verifier\": timeStamp\n    },\n    success: function (data) {\n      tokenInfo = data;\n      getTenant(tokenInfo);\n\n    },\n    error: function (request) {\n      alert(\"Get token error\");\n    }\n  });\n}\n\nfunction getTenant(tokenInfo) {\n  $.ajax({\n    type: \"GET\",\n    url: \"https://oauth.canto.com:443/oauth/api/oauth2/tenant/\" + tokenInfo.refreshToken,\n    success: function (data) {\n      tokenInfo.tenant = data;\n      var cantoContentPage = \"/admin/_canto-dam-assets/canto-embed.twig\";\n      $(\"#cantoUCFrame\").attr(\"src\", cantoContentPage);\n    },\n    error: function (request) {\n      alert(\"Get tenant error\");\n    }\n  });\n}\n\nfunction settings(options) {\n  var envObj = {\n    \"flightbycanto.com\": \"f5ecd6095ebb469691b7398e4945eb44\",\n    \"staging.cantoflight.com\": \"f18c8f3b79644b168cad5609ff802085\",\n    \"canto.com\": \"a9dc81b1bf9d492f8ee3838302d266b2\",\n    \"canto.global\": \"f87b44d366464dfdb4867ab361683c96\",\n    \"canto.de\": \"e7135823e3d046468287e835008da493\",\n    \"cantodemo.com\": \"de5c606732a34b44b99ec20c40f6cb5e\"\n  };\n  env = options.env;\n  appId = envObj[env];\n  formatDistrict = options.extensions;\n}\n\nfunction addEventListener() {\n\n  $(document).on('click', \".canto-uc-iframe-close-btn\", function (e) {\n      $(\"#cantoUCPanel\").addClass(\"hidden\");\n      $(\"#cantoUCFrame\").attr(\"src\", \"\");\n    })\n    .on('click', \".canto-pickup-img-btn\", function (e) {\n      currentCantoTagID = $(e.target).closest(\"canto\").attr(\"id\");\n      $(\"#cantoUCPanel\").removeClass(\"hidden\");\n      loadIframeContent();\n    });\n}\n\n/*--------------------------load iframe content---------------------------------------*/\nfunction initCantoTag() {\n  var body = $(\"body\");\n  var cantoTag = body.find(\"canto\");\n  var imageHtml = '<button class=\"canto-pickup-img-btn\">+ Insert Files from Canto</button>';\n\n  cantoTag.append(imageHtml);\n}\n\n/*--------------------------load iframe content---------------------------------------*/\nfunction loadIframeContent(fieldId, elementId, type, accessToken) {\n  let timeStamp = new Date().getTime();\n  let tokenInfo = {accessToken: accessToken};\n  let cantoLoginPage = \"https://oauth.canto.com/oauth/api/oauth2/universal2/authorize?response_type=code&app_id=\" + \"52ff8ed9d6874d48a3bef9621bc1af26\" + \"&redirect_uri=http://localhost:8080&state=abcd\" + \"&code_challenge=\" + \"1649285048042\" + \"&code_challenge_method=plain\";\n\n  console.log(\"Inside of script.js about to load UC!\");\n  var cantoContentPage = \"/admin/_canto-dam-assets/canto-embed.twig\";\n  if (tokenInfo.accessToken) {\n    // $(\"#cantoUCFrame\").attr(\"data-test\", val);\n    $(\"#cantoUCFrame\").attr(\"data-element\", elementId);\n    $(\"#cantoUCFrame\").attr(\"data-field\", fieldId);\n    $(\"#cantoUCFrame\").attr(\"data-type\", type);\n    $(\"#cantoUCFrame\").attr(\"data-access\", tokenInfo.accessToken);\n    $(\"#cantoUCFrame\").attr(\"src\", cantoContentPage);\n  } else {\n    $(\"#cantoUCFrame\").attr(\"data-element\", elementId);\n    $(\"#cantoUCFrame\").attr(\"data-field\", fieldId);\n    $(\"#cantoUCFrame\").attr(\"data-type\", type);\n    $(\"#cantoUCFrame\").attr(\"src\", cantoLoginPage);\n  }\n}\n\n"],"names":["url","modalMarkup","$modal","pluginName","fieldId","elementId","data","request","type","accessToken","loadIframeContent","options","callback","settings","addEventListener","initCantoTag","event","receiver","getTokenByVerifycode","verifyCode","getTenant","tokenInfo","cantoContentPage","envObj","body","cantoTag","imageHtml","cantoLoginPage"],"mappings":"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"}